steps:
- id: build
  name: "gcr.io/cloud-builders/docker"
  args:
    - 'build'
    - '-t'
    - 'gcr.io/${PROJECT_ID}/single-app:${SHORT_SHA}'
    - './gcb/single-app'

- id: push
  name: "gcr.io/cloud-builders/docker"
  args:
    - 'push'
    - 'gcr.io/${PROJECT_ID}/single-app:${SHORT_SHA}'

- id: kustomize-staging
  name: "gcr.io/${PROJECT_ID}/kustomize"
  args:
    - 'build'
    - './gcb/single-app/k8s/overlays/staging
    - '-o'
    - '/workspace/resources.yaml'

# - id: deploy
#   name: "gcr.io/cloud-builders/gke-deploy"
#   args:
#     - 'run'